<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Module      : Network.Google.Compute.Metadata</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Copyright   : (c) 2015-2016 Brendan Hay</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- License     : Mozilla Public License, v. 2.0.</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  : Brendan Hay &lt;brendan.g.hay@gmail.com&gt;</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   : provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability : non-portable (GHC extensions)</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Google Compute Engine defines a set of default metadata entries that provide</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- information about your instance or project.</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- This module contains functions for retrieving various Compute metadata from an</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- instance\'s local metadata endpoint using 'MonadIO', prior to initialisation</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- of the environment used by the &quot;Network.Google&quot; monad.</span><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Google.Compute.Metadata</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- * Google Compute Instance Check</span><span>
</span><a name="line-20"></a><span>      </span><a href="Network.Google.Compute.Metadata.html#checkGCEVar"><span class="hs-identifier hs-var">checkGCEVar</span></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#isGCE"><span class="hs-identifier hs-var">isGCE</span></a><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-comment">-- * Retrieving Metadata</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getProjectAttribute"><span class="hs-identifier hs-var">getProjectAttribute</span></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getSSHKeys"><span class="hs-identifier hs-var">getSSHKeys</span></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getNumericProjectId"><span class="hs-identifier hs-var">getNumericProjectId</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getProjectId"><span class="hs-identifier hs-var">getProjectId</span></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getInstanceAttribute"><span class="hs-identifier hs-var">getInstanceAttribute</span></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getDescription"><span class="hs-identifier hs-var">getDescription</span></a><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getHostname"><span class="hs-identifier hs-var">getHostname</span></a><span>
</span><a name="line-31"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getInstanceId"><span class="hs-identifier hs-var">getInstanceId</span></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMachineType"><span class="hs-identifier hs-var">getMachineType</span></a><span>
</span><a name="line-33"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getTags"><span class="hs-identifier hs-var">getTags</span></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getZone"><span class="hs-identifier hs-var">getZone</span></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- * Raw Metadata Requests</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#metadataFlavorHeader"><span class="hs-identifier hs-var">metadataFlavorHeader</span></a><span>
</span><a name="line-38"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#metadataFlavorDesired"><span class="hs-identifier hs-var">metadataFlavorDesired</span></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#metadataRequest"><span class="hs-identifier hs-var">metadataRequest</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Exception</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">throwIO</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Catch</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.IO.Class</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadIO</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Aeson</span><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">eitherDecode'</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.ByteString</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LBS</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Char</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toLower</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Encoding</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Text</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Lazy</span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LText</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Lazy.Encoding</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LText</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.Google.Prelude</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.HTTP.Client</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HttpException</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>                                          </span><span class="hs-identifier hs-type">HttpExceptionContent</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Manager</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Network.HTTP.Client</span><span>     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Client</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.HTTP.Types</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HeaderName</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System.Environment</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookupEnv</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">-- | The @NO_GCE_CHECK@ environment variable.</span><span>
</span><a name="line-61"></a><span class="hs-identifier">checkGCEVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-62"></a><a name="checkGCEVar"><a href="Network.Google.Compute.Metadata.html#checkGCEVar"><span class="hs-identifier">checkGCEVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;NO_GCE_CHECK&quot;</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- | The @Metadata-Flavor@ header.</span><span>
</span><a name="line-65"></a><span class="hs-identifier">metadataFlavorHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HeaderName</span><span>
</span><a name="line-66"></a><a name="metadataFlavorHeader"><a href="Network.Google.Compute.Metadata.html#metadataFlavorHeader"><span class="hs-identifier">metadataFlavorHeader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Metadata-Flavor&quot;</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | The desired metadata flavor.</span><span>
</span><a name="line-69"></a><span class="hs-identifier">metadataFlavorDesired</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-70"></a><a name="metadataFlavorDesired"><a href="Network.Google.Compute.Metadata.html#metadataFlavorDesired"><span class="hs-identifier">metadataFlavorDesired</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Google&quot;</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- | Detect if the underlying host is running on GCE.</span><span>
</span><a name="line-73"></a><span class="hs-comment">--</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- The environment variable @NO_GCE_CHECK@ can be set to @1@, @true@, @yes@, or @on@</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- to skip this check and always return @False@.</span><span>
</span><a name="line-76"></a><span class="hs-identifier">isGCE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044104"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044104"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-77"></a><a name="isGCE"><a href="Network.Google.Compute.Metadata.html#isGCE"><span class="hs-identifier">isGCE</span></a></a><span> </span><a name="local-6989586621679044486"><a href="#local-6989586621679044486"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-78"></a><span>    </span><a name="local-6989586621679050405"><a href="#local-6989586621679050405"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679044487"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">lookupEnv</span><span> </span><a href="Network.Google.Compute.Metadata.html#checkGCEVar"><span class="hs-identifier hs-var">checkGCEVar</span></a><span>
</span><a name="line-79"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679050405"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-80"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679044488"><span class="hs-identifier hs-var">success</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">Client.httpLbs</span><span> </span><a href="#local-6989586621679044490"><span class="hs-identifier hs-var">rq</span></a><span> </span><a href="#local-6989586621679044486"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">catch</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679044489"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-81"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-83"></a><span>    </span><a name="local-6989586621679044487"><a href="#local-6989586621679044487"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679044491"><a href="#local-6989586621679044491"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679044491"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;1&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;true&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;yes&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;on&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>    </span><a name="local-6989586621679044488"><a href="#local-6989586621679044488"><span class="hs-identifier">success</span></a></a><span> </span><a name="local-6989586621679045811"><a href="#local-6989586621679045811"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-87"></a><span>           </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Client.responseStatus</span><span> </span><a href="#local-6989586621679045811"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">200</span><span>
</span><a name="line-88"></a><span>        </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="Network.Google.Compute.Metadata.html#metadataFlavorHeader"><span class="hs-identifier hs-var">metadataFlavorHeader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Client.responseHeaders</span><span> </span><a href="#local-6989586621679045811"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>               </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Network.Google.Compute.Metadata.html#metadataFlavorDesired"><span class="hs-identifier hs-var">metadataFlavorDesired</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-identifier">failure</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HttpException</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-92"></a><span>    </span><a name="local-6989586621679044489"><a href="#local-6989586621679044489"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span>    </span><a name="local-6989586621679044490"><a href="#local-6989586621679044490"><span class="hs-identifier">rq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#metadataRequest"><span class="hs-identifier hs-var">metadataRequest</span></a><span>
</span><a name="line-95"></a><span>       </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">Client.responseTimeout</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Client.responseTimeoutMicro</span><span> </span><span class="hs-number">1000000</span><span>
</span><a name="line-96"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- | A directory of custom metadata values that have been set for this project.</span><span>
</span><a name="line-99"></a><span class="hs-identifier">getProjectAttribute</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044103"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044103"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">LBS.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><a name="getProjectAttribute"><a href="Network.Google.Compute.Metadata.html#getProjectAttribute"><span class="hs-identifier">getProjectAttribute</span></a></a><span> </span><a name="local-6989586621679050497"><a href="#local-6989586621679050497"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-101"></a><span>    </span><a href="Network.Google.Compute.Metadata.html#getMetadataMaybe"><span class="hs-identifier hs-var">getMetadataMaybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;project/attributes/&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">Text.encodeUtf8</span><span> </span><a href="#local-6989586621679050497"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- | SSH keys that can connect to instances in the project. SSH keys for Compute</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- Engine use a specialized format where the keys are prepended with a username,</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- like so: @user1:ssh-rsa my-public-ssh-key user1@host.com@</span><span>
</span><a name="line-106"></a><span class="hs-identifier">getSSHKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044102"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044102"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">]</span><span>
</span><a name="line-107"></a><a name="getSSHKeys"><a href="Network.Google.Compute.Metadata.html#getSSHKeys"><span class="hs-identifier">getSSHKeys</span></a></a><span> </span><a name="local-6989586621679050498"><a href="#local-6989586621679050498"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-108"></a><span>    </span><a name="local-6989586621679050499"><a href="#local-6989586621679050499"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataMaybe"><span class="hs-identifier hs-var">getMetadataMaybe</span></a><span> </span><span class="hs-string">&quot;project/attributes/sshKeys&quot;</span><span> </span><a href="#local-6989586621679050498"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-109"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679050499"><span class="hs-identifier hs-var">mx</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-110"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-111"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679050500"><a href="#local-6989586621679050500"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span>
</span><a name="line-112"></a><span>           </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">LText.toStrict</span><span>
</span><a name="line-113"></a><span>           </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">LText.split</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'\n'</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LText.decodeUtf8</span><span> </span><a href="#local-6989586621679050500"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- | The numeric project ID of the instance, which is not the same as the project</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- name visible in the Google Developers Console. This value is different from</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- the project-id metadata entry value. The project-id value is required for all</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- requests to the Compute Engine service.</span><span>
</span><a name="line-120"></a><span class="hs-identifier">getNumericProjectId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044101"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044101"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-121"></a><a name="getNumericProjectId"><a href="Network.Google.Compute.Metadata.html#getNumericProjectId"><span class="hs-identifier">getNumericProjectId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier hs-var">getMetadataText</span></a><span> </span><span class="hs-string">&quot;project/numeric-project-id&quot;</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | The project ID.</span><span>
</span><a name="line-124"></a><span class="hs-identifier">getProjectId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044100"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044100"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-125"></a><a name="getProjectId"><a href="Network.Google.Compute.Metadata.html#getProjectId"><span class="hs-identifier">getProjectId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier hs-var">getMetadataText</span></a><span> </span><span class="hs-string">&quot;project/project-id&quot;</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- | A directory of custom metadata values passed to the instance during startup</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- or shutdown.</span><span>
</span><a name="line-129"></a><span class="hs-identifier">getInstanceAttribute</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044099"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044099"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">LBS.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><a name="getInstanceAttribute"><a href="Network.Google.Compute.Metadata.html#getInstanceAttribute"><span class="hs-identifier">getInstanceAttribute</span></a></a><span> </span><a name="local-6989586621679050501"><a href="#local-6989586621679050501"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-131"></a><span>    </span><a href="Network.Google.Compute.Metadata.html#getMetadataMaybe"><span class="hs-identifier hs-var">getMetadataMaybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;instance/attributes/&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">Text.encodeUtf8</span><span> </span><a href="#local-6989586621679050501"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- | The free-text description of an instance, assigned using the</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- @--description@ flag, or set in the API.</span><span>
</span><a name="line-135"></a><span class="hs-identifier">getDescription</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044098"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044098"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-136"></a><a name="getDescription"><a href="Network.Google.Compute.Metadata.html#getDescription"><span class="hs-identifier">getDescription</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier hs-var">getMetadataText</span></a><span> </span><span class="hs-string">&quot;instance/description&quot;</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | The host name of the instance.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">getHostname</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044097"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044097"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-140"></a><a name="getHostname"><a href="Network.Google.Compute.Metadata.html#getHostname"><span class="hs-identifier">getHostname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier hs-var">getMetadataText</span></a><span> </span><span class="hs-string">&quot;instance/hostname&quot;</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- | The ID of the instance. This is a unique, numerical ID that is generated by</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- Google Compute Engine. This is useful for identifying instances if you do not</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- want to use instance names.</span><span>
</span><a name="line-145"></a><span class="hs-identifier">getInstanceId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044096"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044096"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-146"></a><a name="getInstanceId"><a href="Network.Google.Compute.Metadata.html#getInstanceId"><span class="hs-identifier">getInstanceId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier hs-var">getMetadataText</span></a><span> </span><span class="hs-string">&quot;instance/id&quot;</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">-- | The fully-qualified machine type name of the instance's host machine.</span><span>
</span><a name="line-149"></a><span class="hs-identifier">getMachineType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-150"></a><a name="getMachineType"><a href="Network.Google.Compute.Metadata.html#getMachineType"><span class="hs-identifier">getMachineType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier hs-var">getMetadataText</span></a><span> </span><span class="hs-string">&quot;instance/machine-type&quot;</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-comment">-- | Any tags associated with the instance.</span><span>
</span><a name="line-153"></a><span class="hs-identifier">getTags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044094"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044094"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">]</span><span>
</span><a name="line-154"></a><a name="getTags"><a href="Network.Google.Compute.Metadata.html#getTags"><span class="hs-identifier">getTags</span></a></a><span> </span><a name="local-6989586621679050502"><a href="#local-6989586621679050502"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-155"></a><span>    </span><a name="local-6989586621679050503"><a href="#local-6989586621679050503"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a><span> </span><span class="hs-string">&quot;instance/tags&quot;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679050502"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-156"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">eitherDecode'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Client.responseBody</span><span> </span><a href="#local-6989586621679050503"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-157"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-158"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679050645"><a href="#local-6989586621679050645"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679050645"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">-- | The instance's zone.</span><span>
</span><a name="line-161"></a><span class="hs-identifier">getZone</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044093"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044093"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-162"></a><a name="getZone"><a href="Network.Google.Compute.Metadata.html#getZone"><span class="hs-identifier">getZone</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier hs-var">getMetadataText</span></a><span> </span><span class="hs-string">&quot;instance/zone&quot;</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- -- | A directory of disks attached to this instance.</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- getDisk ::</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- &quot;instance/disks/&quot;</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- -- | A directory of service accounts associated with the instance.</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- getServiceAccount</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- &quot;instance/service-accounts/&quot;</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">-- -- | A directory of network interfaces for the instance.</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- getNetworkInterfaces</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- &quot;instance/network-interfaces/&quot;</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-comment">-- -- | A directory of any external IPs that are currently pointing to this virtual</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- -- machine instance, for the network interface at &lt;index&gt;. Specifically, provides</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- -- a list of external IPs served by forwarding rules that direct packets to this</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- -- instance.</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- getForwardedIPs</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- &quot;instance/network-interfaces/&lt;index&gt;/forwarded-ips/&quot;</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">-- -- | A directory with the scheduling options for the instance.</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- getScheduling</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- &quot;instance/scheduling/&quot;</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- -- | The instance's transparent maintenance event behavior setting. This value is</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- -- set with the @--on_host_maintenance@ flag or via the API.</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- getOnHostMaintenance</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- &quot;instance/scheduling/on-host-maintenance&quot;</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- -- | The instance's automatic restart setting. This value is set with the</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- -- @&#8209;&#8209;automatic_restart@ flag or via the API.</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- getAutomaticRestart</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- &quot;instance/scheduling/automatic-restart&quot;</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- -- | The path that indicates that a transparent maintenance event is affecting this instance.</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- -- See Transparent maintenance notice for details.</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- getMaintenanceEvent</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- &quot;instance/maintenance-event&quot;</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span class="hs-comment">-- Metadata wait for change</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- curl &quot;http://metadata.google.internal/computeMetadata/v1/instance/tags?wait_for_change=true&quot;</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-identifier">getMetadataMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044092"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-206"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-207"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span>
</span><a name="line-208"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044092"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">LBS.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-209"></a><a name="getMetadataMaybe"><a href="Network.Google.Compute.Metadata.html#getMetadataMaybe"><span class="hs-identifier">getMetadataMaybe</span></a></a><span> </span><a name="local-6989586621679050646"><a href="#local-6989586621679050646"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679050647"><a href="#local-6989586621679050647"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621679050648"><a href="#local-6989586621679050648"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a><span> </span><a href="#local-6989586621679050646"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">404</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679050647"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-211"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Client.responseStatus</span><span> </span><a href="#local-6989586621679050648"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">404</span><span>
</span><a name="line-212"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-213"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Client.responseBody</span><span> </span><a href="#local-6989586621679050648"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-identifier">getMetadataText</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679044002"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-216"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-217"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span>
</span><a name="line-218"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044002"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-219"></a><a name="getMetadataText"><a href="Network.Google.Compute.Metadata.html#getMetadataText"><span class="hs-identifier">getMetadataText</span></a></a><span> </span><a name="local-6989586621679050649"><a href="#local-6989586621679050649"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679050650"><a href="#local-6989586621679050650"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LText.toStrict</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">LText.decodeUtf8</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">Client.responseBody</span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Network.Google.Compute.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a><span> </span><a href="#local-6989586621679050649"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679050650"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-identifier">getMetadata</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679041680"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-223"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-comment">-- ^ The request path.</span><span>
</span><a name="line-224"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ Acceptable status code responses.</span><span>
</span><a name="line-225"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span>
</span><a name="line-226"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679041680"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Client.Response</span><span> </span><span class="hs-identifier hs-type">LBS.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-227"></a><a name="getMetadata"><a href="Network.Google.Compute.Metadata.html#getMetadata"><span class="hs-identifier">getMetadata</span></a></a><span> </span><a name="local-6989586621679050651"><a href="#local-6989586621679050651"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679050652"><a href="#local-6989586621679050652"><span class="hs-identifier">statuses</span></a></a><span> </span><a name="local-6989586621679050653"><a href="#local-6989586621679050653"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">Client.httpLbs</span><span> </span><a href="#local-6989586621679050653"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-229"></a><span>        </span><a href="Network.Google.Compute.Metadata.html#metadataRequest"><span class="hs-identifier hs-var">metadataRequest</span></a><span>
</span><a name="line-230"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">Client.path</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;/computeMetadata/v1/&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679050651"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-231"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Client.checkResponse</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679050654"><a href="#local-6989586621679050654"><span class="hs-identifier">rq</span></a></a><span> </span><a name="local-6989586621679050655"><a href="#local-6989586621679050655"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-232"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679050656"><a href="#local-6989586621679050656"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Client.responseStatus</span><span> </span><a href="#local-6989586621679050655"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-number">200</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679050656"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679050656"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">300</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">notElem</span><span> </span><a href="#local-6989586621679050656"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679050652"><span class="hs-identifier hs-var">statuses</span></a><span>
</span><a name="line-234"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-236"></a><span>                         </span><a name="local-6989586621679050730"><a href="#local-6989586621679050730"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Client.brReadSome</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Client.responseBody</span><span> </span><a href="#local-6989586621679050655"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">4096</span><span>
</span><a name="line-237"></a><span>                         </span><span class="hs-identifier hs-var">throwIO</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">HttpExceptionRequest</span><span> </span><a href="#local-6989586621679050654"><span class="hs-identifier hs-var">rq</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-238"></a><span>                             </span><span class="hs-identifier hs-var">StatusCodeException</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><a href="#local-6989586621679050655"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LBS.toStrict</span><span> </span><a href="#local-6989586621679050730"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- | A default @http-client@ 'Client.Request' with the host, port, and headers</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- set appropriately for @metadata.google.internal@ use.</span><span>
</span><a name="line-243"></a><span class="hs-identifier">metadataRequest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Client.Request</span><span>
</span><a name="line-244"></a><a name="metadataRequest"><a href="Network.Google.Compute.Metadata.html#metadataRequest"><span class="hs-identifier">metadataRequest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Client.defaultRequest</span><span>
</span><a name="line-245"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">Client.host</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;metadata.google.internal&quot;</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Client.port</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">80</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Client.secure</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Client.method</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;GET&quot;</span><span>
</span><a name="line-249"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Client.requestHeaders</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Network.Google.Compute.Metadata.html#metadataFlavorHeader"><span class="hs-identifier hs-var">metadataFlavorHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.Google.Compute.Metadata.html#metadataFlavorDesired"><span class="hs-identifier hs-var">metadataFlavorDesired</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-250"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-251"></a></pre></body></html>